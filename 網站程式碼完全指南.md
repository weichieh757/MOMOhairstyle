# 網站程式碼完全指南 (Full Code Guide)

這份文件詳細記錄了 MOMO HAIRSTYLE 網站專案中，每一個核心檔案的功能、程式碼邏輯以及它們是如何互相運作的。這是一份為您準備的進階學習教材。

---

## 🏗 當前網站架構 (Architecture)

您的網站採用了經典的 **前後端分離 (但同源部署)** 架構：

1.  **後端 (Backend)**: 使用 **Python Flask**。
    *   負責提供網頁檔案 (HTML/CSS/JS)。
    *   負責提供 API 資料接口 (例如：給前端「所有商品」的資料)。
    *   負責與資料庫 (`shop.db`) 溝通。
2.  **前端 (Frontend)**: 使用 **HTML + CSS + Vanilla JavaScript (原法 JS)**。
    *   負責畫面顯示。
    *   負責跟後端 API 要資料並動態產生內容。

---

## 1. 後端核心：`app.py`

### 檔案用途
這是整個網站的「伺服器」。當您執行 `python app.py` 時，就是啟動了這個程式。

### 程式碼逐段解析

#### A. 引入函式庫
```python
import sqlite3      # 用來操作 SQLite 資料庫
import os          # 用來操作作業系統 (如建立資料夾)
import json        # 用來處理 JSON 資料格式
from flask import Flask, request, jsonify, send_from_directory
# Flask: 網站框架核心
# request: 當有人送資料來時，用這個抓取資料 (例如表單內容)
# jsonify: 把 Python 的字典資料轉成 JSON 傳給前端
# send_from_directory: 用來傳送靜態檔案 (如 html)
```

#### B. 初始化與設定
```python
app = Flask(__name__, static_folder='.', static_url_path='')
# 建立 Flask 網站應用程式。
# static_folder='.': 設定目前的資料夾就是靜態檔案資料夾，這樣才能直接讀取 css 或圖片。
```

#### C. 資料庫連線
```python
def get_db_connection():
    conn = sqlite3.connect('shop.db')
    conn.row_factory = sqlite3.Row # 讓抓出來的資料可以用欄位名稱皆讀取 (如 row['name'])
    return conn
```

#### D. 路由 (Routes) - 網頁
```python
@app.route('/')
def home():
    return send_from_directory('.', 'MOindex.html')
```
*   `@app.route('/')`: 當使用者網址輸入 `domain.com/` 時。
*   `return send_from_directory(...)`: 傳送 `MOindex.html` 檔案給他看。
*   其他的 `/about`, `/product` 等路由也是一樣的道理。

#### E. API 接口 - 資料的核心
前端網頁本身是「空的」(沒有寫死商品)，網頁打開後會跑去問這些 API。

1.  **取得所有商品 (`GET /api/products`)**
    *   連線資料庫 `SELECT * FROM products`。
    *   把資料庫裡的 JSON 字串 (文字) 轉換回 Python 列表。
    *   回傳 JSON 格式給前端。

2.  **取得單一商品 (`GET /api/products/<id>`)**
    *   根據網址的 ID (如 `/api/products/5`) 去搜尋資料庫。

3.  **上架/修改商品 (`POST /api/products`)**
    *   這是最複雜的一段。
    *   `request.form`: 抓取文字資料 (名稱、價格)。
    *   `request.files`: 抓取上傳的圖片檔案。
    *   **圖片處理邏輯**:
        *   新上傳的圖：存到 `uploads` 資料夾，產生路徑。
        *   舊圖 (`existing_images`)：保留原本的路徑。
        *   最後合併成一個列表，存回資料庫。

---

## 2. 樣式核心：`css/styles.css`

### 檔案用途
管理全站的外觀。我們做了「樣式重構」，把原本散落在各個 HTML 的 `<style>` 全部集中到這裡。

### 關鍵技術解析

#### A. CSS 變數 (Variables)
```css
:root {
    --accent: #0250c7;      /* 定義全站的主題藍色 */
    --header-bg: #0250c7;   /* 定義導覽列背景色 */
}
```
*   **用途**: 以後想換顏色，只要改這裡一行，全站幾百個按鈕都會一起變色。

#### B. 響應式導覽列 (Mobile Menu)
```css
@media (max-width: 768px) {
    /* 當螢幕寬度小於 768px (平板/手機) */
    nav ul.mobile-menu {
        position: fixed;   /* 固定定位，浮在畫面上 */
        right: -100%;      /* 預設藏在螢幕右邊外面 */
        background: rgba(2, 80, 199, 0.95);
        transition: right 0.3s ease; /* 滑動動畫 */
    }
    nav ul.mobile-menu.active {
        right: 0;          /* 加上 active class 後滑進來 */
    }
}
```

#### C. 手機版優化技巧
```css
.story-section {
    min-height: 100vh;
    height: 100dvh; /* 關鍵！解決 iPhone Safari 下方工具列遮擋問題 */
}
```

---

## 3. 前端頁面邏輯解析

### A. 首頁 (`MOindex.html`)

*   **`<picture>` 標籤**: 實現「電腦看寬圖、手機看長圖」。
    ```html
    <picture>
        <source media="(max-width: 768px)" srcset="uploads/2026_m.jpg">
        <img src="uploads/2026.jpg">
    </picture>
    ```
*   **JavaScript `fetchProducts()`**:
    網頁載入後，JS 會執行 `fetch('/api/products')`，拿到資料後用 `forEach` 跑迴圈，動態產生 `<div class="product-card">...</div>` 的 HTML 塞進網頁。這就是為什麼您不用手動新增商品 HTML。

### B. 電商購物車 (`MOcart.html`)

*   **資料儲存**:
    我們沒有把購物車存到資料庫(太複雜)，而是存在使用者的瀏覽器裡 (`localStorage`)。
    *   您可以打開瀏覽器 F12 -> Application -> Local Storage 看到 `momoCart` 的資料。
*   **結帳功能**:
    當按下結帳時，JS 會把 `localStorage` 裡的資料 + 使用者填寫的姓名，打包成 JSON 發送給後端 `/api/checkout`。

### C. 後台管理 (`admin.html`)

這是功能最強大的頁面。

*   **表單資料處理 (`FormData`)**:
    因為要上傳圖片，不能只傳 JSON。我們使用 `new FormData(form)` 物件，它可以同時包裝文字和二進位檔案(圖片)，就像傳統表單一樣送出。
*   **圖片庫 (Gallery)**:
    點選「從圖庫選擇」時，會呼叫 `/api/images` 列出伺服器上所有現存圖片，讓您重複利用舊圖，不用每次都重新上傳。
*   **動態規格欄位**:
    「新增規格」按鈕會用 JS 動態 `createElement` 產生新的輸入框列，並在送出時遍歷這些輸入框蒐集資料。

### D. 商品詳情 (`MOproduct.html`)

*   **網址參數解析**:
    網址通常長這樣：`MOproduct.html?id=123`。
    JS 使用 `new URLSearchParams(window.location.search).get('id')` 來抓到 `123` 這個數字，然後去 API 查這個 ID 的資料。
*   **Google 結構化資料 (JSON-LD)**:
    在 renderProduct 函式最後，我們動態塞了一段 `<script type="application/ld+json">`。這是給 Google 搜尋引擎看的，告訴 Google：「這是一個商品，價格是 500 元」。

---

## 學習建議

您可以嘗試從簡單的修改開始：
1.  **改顏色**: 去 `css/styles.css` 修改 `:root` 裡的顏色代碼。
2.  **改文字**: 去 `MOindex.html` 修改 `<div class="story-desc">` 裡的介紹文字。
3.  **觀察 API**: 打開瀏覽器的開發者工具 (F12) -> Network 分頁，重新整理網頁，看看 `products` 這個請求的回傳內容，您會更了解前後端是怎麼溝通的。
